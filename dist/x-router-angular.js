!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("angular")):"function"==typeof define&&define.amd?define("xrouterangular",["angular"],n):"object"==typeof exports?exports.xrouterangular=n(require("angular")):e.xrouterangular=n(e.angular)}(this,function(e){return function(e){function n(t){if(r[t])return r[t].exports;var o=r[t]={exports:{},id:t,loaded:!1};return e[t].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var r={};return n.m=e,n.c=r,n.p="",n(0)}([function(e,n,r){function t(e){return"object"==typeof Node&&e instanceof Node||!("number"!=typeof e.nodeType||!e.nodeName)}function o(e){return"object"==typeof Element&&e instanceof Element||!(1!==e.nodeType||!e.tagName||"function"!=typeof e.setAttribute)}function u(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)}function c(e,n){return n=n||function(e){e&&console.error(e)},o(e)&&(e=m.element(e).scope()),e?e.$root?e.$apply?void("$apply"==e.$$phase||"$digest"==e.$$phase||"$apply"==e.$root.$$phase||"$digest"==e.$root.$$phase?n(null,e):e.$apply(function(){n(null,e)})):n(new TypeError("invalid scope (scope.$apply not found)")):n(new TypeError("invalid scope (scope.$root not found)")):n(new TypeError("not found scope"))}function l(e,n,r){if(r=r||function(e){e&&console.error(e)},!n)return r(new TypeError("missing elements"));if(t(n)&&(n=[n]),!u(n))return r(new TypeError("unknwon type of elements: "+n));if("string"==typeof e&&(el=document.querySelector(e)),!e)return r(new Error("not found parent scope element"));if(!o(e))return r(new Error("parent must be an element"));e=m.element(e);var c=e.scope(),l=e.injector();return c?l?([].forEach.call(n,function(e){e.__packed__||(e.__packed__=!0,l.invoke(["$compile","$rootScope",function(n,r){n(e)(c||r),r.$digest()}]))}),void r(null,n)):r(new Error("not found parent scope injector")):r(new Error("not found parent scope"))}function a(e,n){return"string"==typeof e&&(e=document.querySelector(e)),e?o(e)?(n&&(e=e.querySelector('*[ng-controller="'+n+'"]')),e?m.element(e).scope():null):console.error("element must be an element or selector",arguments[0]):console.error("missing element",e)}function p(e){if("string"==typeof e&&(e=document.querySelector(e)),!e)return console.error("not found element",e);if(!o(e))return console.error("element must be an element or selector",arguments[0]);var n=e.querySelectorAll("*[ng-controller]"),r=[],t=r.elements=[];return[].forEach.call(n,function(e){var n=e.getAttribute("ng-controller"),o=m.element(e).scope();r.push(o),r[n]=o,t.push(e),t[n]=e}),r}function i(e){function n(){if(!e)return null;var r=m.element(e).scope();return r?e:(e=e.parentNode,void n())}return n()}function s(e){var n=i(e);return n&&m.element(n).scope()}function f(e){e=e||{};var n=function(){return e.app?document.querySelector('[ng-app="'+e.app+'"]'):document.querySelector("[ng-app]")};return function(r,t){var o=r.src,u=r.html,c=r.target,a=r.parent,s=r.controller,f=r.flat||e.flat;if(s&&"string"==typeof s){var d=document.createElement("div");d.setAttribute("ng-controller",s),c.innerHTML="",c.appendChild(d),a=c=d}if("parent"in r||(a=e.parent,a||f||(a=i(c))),a||(a=n()),o){var m=r.singleton;if("singleton"in r||(m=e.singleton),m&&y[o])return function(){c.innerHTML="",[].forEach.call(y[o].els,function(e){try{c.appendChild(e)}catch(e){console.warn("[x-router-angular] dom append error",e)}}),t(null,y[o].scopes)}();y[o]=null,delete y[o],this.util.ajax(o,function(e,n){if(e)return t(e);var r=document.createElement("div");r.innerHTML=n;var u=[];c.innerHTML="",[].forEach.call(r.childNodes,function(e){try{c.appendChild(e),u.push(e)}catch(e){console.warn("[x-router-angular] dom append error",e)}}),l(a,u,function(e){if(e)return t(e);var n=p(c);m&&(y[o]={els:u,scopes:n}),t(null,n)})})}else{if(!u)return t(new Error("src or html must be defined"));var g=document.createElement("div");g.innerHTML=u;var h=[];c.innerHTML="",[].forEach.call(g.childNodes,function(e){try{c.appendChild(e),h.push(e)}catch(e){console.warn("[x-router-angular] dom append error",e)}}),setTimeout(function(){l(a,h,function(e){return e?t(e):void t(null,p(c))})},1)}}}function d(e){e=e||{};var n=e.app,r=function(){return n?document.querySelector('[ng-app="'+n+'"]'):document.querySelector("[ng-app]")};return function(e,n,t){n.ensure=function(e,n){return c(e,n),this},n.pack=function(e,n){return l(r(),e,n),this},n.scope=function(e,n){return arguments.length?a(e,n):a(r())},n.scopes=function(e){return p(e)},t()}}var m=r(1),y={};f.ensure=c,f.pack=l,f.scope=a,f.scopes=p,f.parentelement=i,f.parentscope=s,f.middleware=d,f.cache=y,f.clearCache=function(){y={}},e.exports=f,m.module("xRouterAngular",[]).service("xRouterAngular",function(){return{ensure:c,pack:l,scope:a,scopes:p,parentelement:i,parentscope:s,cache:y,clearCache:function(){y={}}}})},function(n,r){n.exports=e}])});